# 볼링 점수판 - OOP

- [볼링 게임 점수판 레포지토리](https://github.com/next-step/java-bowling/tree/seokrae)

## 정신교육 - 변화는 어떻게 만들어 갈 것인가?

- 변화에 대한 시선
	- 사람들은 기본적으로 변화를 거부하는 성향을 가지고 있다.
	- 팀은 변화를 거부하는 성향이 더 강하다.
	- 대부분의 사람들은 변화에 실패한 경험을 가지고 있다.

- 변화를 변화하기
	- 작은 성공을 통해 성취감과 안정감을 통해 신뢰감을 형성한다.

  ```text
  회고 -> Practice 선택 -> 한 가지에 집중 -> 작은 성공 -> 반복
  ```

	- 짝 프로그래밍으로 TDD, 리펙토링 경험하기

## 레거시 코드 리펙토링 및 미션 요구사항

- 학습 테스트 - JUnit 사용법 및 단위 테스트 연습
- 단위 테스트 - 내가 구현한 코드에 대한 단위 테스트
- TDD - 익숙해질 때까지 같은 미션으로 반복 연습
- 점진적으로 리펙토링하기 - 레거시 코드 리펙토링
	- 기존의 Test Case가 깨지지 않는 상태로 리펙토링하기
	- 컴파일 에러 발생을 최소화하면서 리펙토링하기

> 레거시 코드 리펙토링

- 응용 애플리케이션(웹, 모바일 애플리케이션)을 개발할 때
  TDD, OOP를 적용하려면 핵심 비즈니스 로직을 도메인 객체가 담당하도록 구현하는 것이다.
- 즉, **`테스트하기 쉬운 부분`**과 **`테스트하기 어려운 부분`**을 분리해 `테스트하기 쉬운 부분에 대한 단위테스트를 구현`하고, `지속적인 리펙토링`을 한다.

- 레거시 코드 리펙토링의 1단계
	- `Service Layer에 단위 테스트를 추가`한 뒤 `비즈니스 로직`을 `도메인 객체로 이동`하는 리펙토링
	- Acceptance Test를 추가한 후 리펙토링
- `Service Layer`에 `단위 테스트`를 추가한 후 `비즈니스 로직`을 `도메인 객체로 이동하는 리펙토링`이다.

- `Mockito`는 학습비용이 높기 때문에 도메인 클래스에서 Mock 없이 테스트 코드를 작성할 수 있도록 하는 것을 목표로 한다.

## 1단계 - 질문 삭제하기 기능 리팩토링

- [1단계 - QnA 서비스 게시물 삭제 리펙토링](https://github.com/next-step/java-bowling/pull/462)

- 질문 삭제하기 요구사항
	- 질문 데이터를 완전히 삭제하는 것이 아니라 데이터의 상태를 삭제상태(deleted - boolean type)로 변경한다.
	- 로그인 사용자와 질문한 사람이 같은 경우 삭제 가능하다.
	- `답변이 없는 경우` `삭제가 가능`하다.
	- `질문자`와 `답변 글`의 `모든 답변자 같은 경우 삭제가 가능`하다.
	- 질문을 삭제할 때 답변 또한 삭제해야 하며, 답변의 삭제 또한 삭제 상태(deleted)를 변경한다.
	- 질문자와 답변자가 다른경우 답변을 삭제할 수 없다.
	- 질문과 답변 삭제 이력에 대한 정보를 `DeleteHistory`를 활용해 남긴다.

- 프로그래밍 요구사항
	- qna.service.QnaService의 deleteQuestion()는 앞의 질문 삭제 기능을 구현한 코드이다.
	- 이 메소드는 단위 테스트하기 어려운 코드와 단위 테스트 가능한 코드가 섞여 있다.
	- 단위 테스트하기 어려운 코드와 단위 테스트 가능한 코드를 분리해 단위 테스트 가능한 코드 에 대해 단위 테스트를 구현한다.

- 힌트1
	- 객체의 상태 데이터를 꺼내지(get)말고 메시지를 보낸다.
	- 규칙 8: 일급 콜렉션을 쓴다.
	- Question의 List를 일급 콜렉션으로 구현해 본다.
	- 규칙 7: 3개 이상의 인스턴스 변수를 가진 클래스를 쓰지 않는다.
	- 인스턴스 변수의 수를 줄이기 위해 도전한다.

- 힌트2
	- 테스트하기 쉬운 부분과 테스트하기 어려운 부분을 분리해 테스트 가능한 부분만 단위테스트한다.


> 1단계 피드백

- [x] [람다 표현식](https://github.com/next-step/java-bowling/pull/462#discussion_r612984519)

## 2단계 - 볼링 게임 점수판(그리기)

- 볼링 규칙 알아보기
	- 총 10개의 볼링 핀(Pin)을 볼링공(Ball)을 굴려 쓰러뜨리는 경기이다.
	- 총 10 프레임(frame)의 게임을 하며, 하나의 프레임에 2번의 기회(Try)가 주어진다.
	- 10개 핀 중 초구에 핀을 모두 쓰러뜨리지 못한 경우 한번의 기회를 더 주어진다.
		- 초구에 10개 핀을 모두 쓰러뜨리는 경우 Strike로 10점을 획득 가능하다.
		- 2구까지 진행하여 모두 쓰러뜨리는 경우 Spare 처리라 한다.
	- 레인에서 벗어나는 경우 GUTTER라 한다.
	- 핀을 맞추지 못한 경우 OPEN이라 한다.

	- 한 프레임당 최대 30점까지 받을 수 있다.
	- 1프레임부터 10 프레임까지 모두 스트라이크를 친 경우 퍼펙트 게임 300점이 된다.

- 볼링 점수 계산 방법
	- 거터
		- 1프레임 동안 하나의 핀도 넘어뜨리지 못한 경우
		- 0점 처리
	```text
	|   01    |   02    |   03    |   04    |   05    |   06    |   07    |   08    |   09    |   10    |
	|  - | -  |   
	|    0    |
	```

	- 오픈
		- 한 프레임에 10개 핀을 모두 쓰러뜨리지 못한 경우
		- 초구와 2구를 쓰러뜨린 핀의 수가 점수로 확정된다.
		- 초구 8핀, 2구 1핀을 넘겼으므로 8 + 1 = 9 점으로 계산된다.
	```text
	|   01    |   02    |   03    |   04    |   05    |   06    |   07    |   08    |   09    |   10    |
	|  8 | 1  |   
	|    9    |
	```

	- 스페어
		- 1프레임에 초구 9개 핀을 쓰러뜨린 후, 2구에 남은 1개핀을 쓰려뜨린 경우 Spare 처리라 한다.
		- 이 경우 점수를 획득할 수 있는 방법이 2가지로 나뉜다.
		- 첫 번째 1프레임에 스페어 처리를 한 후 2프레임에 8개를 쓰러뜨린다면 1프레임에 10점 + 8점을 획득하여 18점이 된다.
		- 스페어 처리 시 다음 프레임에 스트라이크를 못친 경우, 다음 프레임의 초구만 보너스 점수로 얻을 수 있다.
		
	```text
	|   01    |   02    |   03    |   04    |   05    |   06    |   07    |   08    |   09    |   10    |
	|  9 | /  |	 8 |   
	|   18    |
	```
        - 1프레임에 스페어 처리를 한 후, 2프레임에 10개를 모두 쓰러뜨려 Strike를 쳤다면 
        1프레임 10점에 보너스 10점을 획득하여 1프레임의 점수 10 + 10 = 20점이 된다.

	```text
	|   01    |   02    |   03    |   04    |   05    |   06    |   07    |   08    |   09    |   10    |
	|  9 | /  |	 X |   
	|   20    |
	```

	- 스트라이크
		- 스트라이크를 친 후에는 다음 프레임 2구까지 보너스 점수로 반영이 된다.
		- 1프레임 스트라이크 친 후 2프레임 초구에 7개, 2구에 3개를 쓰러뜨려 스페어 처리를 하였다.
		- 이때 1프레임 10점에 보너스 10점을 획득하여, 1프레임 점수는 10 + 10 = 20점이 된다.
	
	```text
	|   01    |   02    |   03    |   04    |   05    |   06    |   07    |   08    |   09    |   10    |
	|  X |    |	 7 | /  |
	|   20    |
	```

		- 1프레임 스트라이크를 친 후에 2프레임 초구에 7개, 2구에 2개를 쓰러뜨려 오픈이 나온경우
		- 1프레임 10점에 보너스 초구 7점, 2구 2점을 획득하여 10 + 7 + 2 = 19점이 된다.

	```text
	|   01    |   02    |   03    |   04    |   05    |   06    |   07    |   08    |   09    |   10    |
	|  X |    |	 7 | 2  |
	|   19    |
	```

	- 연속 스트라이크
		- 스트라이크를 2번 이상 쳤을 때 점수가 많이 높아지는 경기이다.
		- 스트라이크를 2번 연속으로 치게되면 보너스 점수는 3프레임까지 반영이 된다.
		- 보너스 점수가 반영되는 것은 최대 3개 프레임의 결과이다.
		- 3 프레임이 지나가면 이전 프레임 점수는 확정이 된다.
	
		- 1프레임 스트라이크, 2프레임 스트라이크 연속을 `더블`이라 한다.
		- 아래 예시는 `보너스 점수`가 `3프레임의 초구 결과`까지 `반영`된다.
		- 1프레임 점수는 1프레임 10점, 2프레임 10점, 3프레임 초구 8점을 계산하여 10 + 10 + 8 = 28점이 된다.
		    - 1 프레임 총 점수 28 점
		- 2프레임 점수는 2프레임 10점에 3프레임 초구 8점, 2구 1점을 계산하여 10 + 8 + 1 = 19 점이 된다.
		    - 2 프레임 총 점수 28 + 19 = 47 점
		- 3프레임 점수는 스페어 처리를 못하였기 때문에 초구 8점, 2구 1점을 합산하여 8 + 1 = 9점이 된다.
			- 결국 1프레임 28점, 2프레임 19점을 계산하여 28 + 19 + 9 = 56점이 확정 점수가 된다.
	
	```text
	|   01    |   02    |   03    |   04    |   05    |   06    |   07    |   08    |   09    |   10    |
	|  X |    |	 X |    |  8 | 1  | 
	|   28    |	  47	|	56
	```

		- 1프레임 10점, 2프레임 10점, 3프레임 8점으로 1프레임의 총 점수는 10 + 10 + 8 = 28 점이 된다.
		- 2프레임은 3프레임의 초구, 2구가 모두 반영되기 때문에 2프레임 10점에 3프레임 10점으로 20점이 된다.
		- 3프레임은 스페어 처리를 했기 때문에 4프레임의 결과에 따라 점수가 확정된다.
		- 4프레임은 초구 2개, 2구 8개로 스페어 처리되었으므로 5프레임의 결과에 따라 점수가 확정된다.

	```text
	|   01    |   02    |   03    |   04    |   05    |   06    |   07    |   08    |   09    |   10    |
	|  X |    |	 X |    |  8 | /  |  2 | /  |
	|   28    |	  48	|	59	  |
	```

	- 3연속 스트라이크(터키)
		- 보너스 점수는 첫 스트라이크 부터 최대 3프레임까지 반영된다.
		- 1프레임, 2프레임, 3프레임 모두 스트라이크를 친 경우
		- 1프레임 기본점수 10점, 2프레임 보너스 점수 10점, 3프레임 보너스 점수 10점을 계산하여 30점이 된다.
	
	```text
	|   01    |   02    |   03    |   04    |   05    |   06    |   07    |   08    |   09    |   10    |
	|  X |    |	 X |    |  X |    |
	|   30    |			|		  |
	```

	- 10프레임 계산 방법
		- 최대 3번까지 기회를 가질 수 있다.
		- 2구 스트라이크 또는 스페어 처리를 한 경우에 3구에 대한 기회가 주어진다.

	```text
	|   01    |   02    |   03    |   04    |   05    |   06    |   07    |   08    |   09    |     10    |
	|  X |    |	 X |    |  X |    |  X |    |  X |    |  X |    |  X |    |	 X |    |  X |    | 8 | / | X |
	|   30    |	  60 	|	90    |   120   |   150   |   180   |   210   |   240   |   270   |    290    | 
	```

	    - 초구에 스트라이크를 못치고 2구에 스페어 처리를 하지 못한 경우 3구의 기회가 없이 게임이 종료된다.

	```text
	|   01    |   02    |   03    |   04    |   05    |   06    |   07    |   08    |   09    |     10    |
	|  X |    |	 X |    |  X |    |  X |    |  X |    |  X |    |  X |    |	 X |    |  X |    | 8 | 1 |   |
	|   30    |	  60 	|	90    |   120   |   150   |   180   |   210   |   240   |   270   |    279    | 
	```

	    - 10 프레임 안에서의 3번의 기회는 보너스 점수가 없다.
	    - 초구 스트라이크, 2구 9핀, 3구 남은 1핀 스페어 처리를 한 경우 10 + 9 + 1 = 20점을 획득한다.

	```text
	|   01    |   02    |   03    |   04    |   05    |   06    |   07    |   08    |   09    |     10    |
	|  X |    |	 X |    |  X |    |  X |    |  X |    |  X |    |  X |    |	 X |    |  X |    | X | 9 | 1 |
	|   30    |	  60 	|	90    |   120   |   150   |   180   |   210   |   240   |   270   |    290    | 
	```

	- 퍼펙트
		- 10 프레임은 초구, 2구, 3구 모두 스트라이크를 쳐야지 30점이 된다.

	```text
	|   01    |   02    |   03    |   04    |   05    |   06    |   07    |   08    |   09    |     10    |
	|  X |    |	 X |    |  X |    |  X |    |  X |    |  X |    |  X |    |	 X |    |  X |    | X | X | X |
	|   30    |	  60 	|	90    |   120   |   150   |   180   |   210   |   240   |   270   |    300    | 
	```
